<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtual Office - Multiplayer Space</title>
  <link rel="stylesheet" href="style.css?v=20.3">
</head>
<body>
  <div id="login-screen" class="screen active">
    <div class="login-box">
      <h1>🏢 Virtual Office</h1>
      <p>เข้าร่วมพื้นที่ทำงานเสมือนจริง (Map Sync ✨)</p>
      <input
        type="text"
        id="username-input"
        placeholder="ใส่ชื่อของคุณ"
        maxlength="20"
        autocomplete="off"
      />
      <select id="room-select">
        <option value="lobby" selected>🏠 Lobby (Center)</option>
        <option value="workspace-1">💼 Workspace 1</option>
        <option value="workspace-2">💼 Workspace 2</option>
        <option value="meeting-room-1">🎯 Meeting Room 1</option>
        <option value="meeting-room-2">📊 Meeting Room 2</option>
        <option value="huddle-room">🤝 Huddle Room</option>
        <option value="lounge">☕ Lounge</option>
        <option value="kitchen">🍕 Kitchen</option>
        <option value="game-room">🎮 Game Room</option>
      </select>
      <button id="join-btn">เข้าร่วมแบบ Guest</button>

      <div class="login-divider">
        <span>หรือ</span>
      </div>

      <button id="planning-tool-login-btn" class="planning-tool-btn">
        🔐 Login with Planning Tool
      </button>

      <div id="user-info" style="display: none;">
        <p>ยินดีต้อนรับ, <strong id="logged-in-username"></strong>!</p>
        <button id="logout-btn" class="secondary-btn">Logout</button>
      </div>
    </div>
  </div>

  <div id="game-screen" class="screen">
    <!-- Left Sidebar (Teams-style) -->
    <div id="left-sidebar">
      <div class="sidebar-item active" data-tab="chat">
        <div class="sidebar-icon">💬</div>
        <div class="sidebar-label">Chat</div>
      </div>
      <div class="sidebar-item" data-tab="activity">
        <div class="sidebar-icon">🔔</div>
        <div class="sidebar-label">Activity</div>
      </div>
      <div class="sidebar-item" data-tab="calendar">
        <div class="sidebar-icon">📅</div>
        <div class="sidebar-label">Calendar</div>
      </div>
      <div class="sidebar-item" data-tab="files">
        <div class="sidebar-icon">🔖</div>
        <div class="sidebar-label">Bookmark</div>
      </div>
      <div class="sidebar-item" id="history-btn">
        <div class="sidebar-icon">📜</div>
        <div class="sidebar-label">History</div>
      </div>
      <div class="sidebar-item" id="minigame-btn">
        <div class="sidebar-icon">🎮</div>
        <div class="sidebar-label">Mini Game</div>
      </div>
      <div class="sidebar-item" id="guest-link-btn">
        <div class="sidebar-icon">🔗</div>
        <div class="sidebar-label">Guest Link</div>
      </div>
      <div class="sidebar-item" id="profile-btn">
        <div class="sidebar-icon">👤</div>
        <div class="sidebar-label">Profile</div>
      </div>

      <!-- Version Info -->
      <div class="version-info">
        <div class="version-label">Version</div>
        <div class="version-number">20.3</div>
      </div>
    </div>

    <!-- Chat Panel -->
    <div id="chat-panel">
      <div class="chat-panel-header">
        <h2>Chat</h2>
        <div class="header-actions">
          <button class="icon-btn">🔍</button>
          <button class="icon-btn">⚙️</button>
          <button class="icon-btn" id="toggle-chat-panel-btn">◀</button>
        </div>
      </div>

      <div class="chat-filters">
        <button class="filter-btn active">Unread</button>
        <button class="filter-btn">Channels</button>
        <button class="filter-btn">Chats</button>
        <button class="filter-btn">Meeting chats</button>
      </div>

      <div class="chat-quick-items">
        <div class="quick-item">
          <span class="quick-icon">🤖</span>
          <span>Copilot</span>
        </div>
        <div class="quick-item">
          <span class="quick-icon">@</span>
          <span>Mentions</span>
        </div>
        <div class="quick-item">
          <span class="quick-icon">💬</span>
          <span>Followed threads</span>
        </div>
      </div>

      <div class="chat-section">
        <div class="section-header collapsed">
          <span class="expand-icon">▶</span>
          <span>Favorite</span>
        </div>
        <div class="chat-list" id="favorite-players-list" style="display: none;">
          <!-- Favorite players will be listed here -->
        </div>
      </div>

      <div class="chat-section">
        <div class="section-header">
          <span class="expand-icon">▼</span>
          <span>Online</span>
        </div>
        <div class="chat-list" id="online-players-list">
          <!-- Online players will be listed here -->
        </div>
      </div>

      <div class="chat-section">
        <div class="section-header collapsed">
          <span class="expand-icon">▶</span>
          <span>Offline</span>
        </div>
        <div class="chat-list" id="offline-players-list" style="display: none;">
          <!-- Offline players will be listed here -->
        </div>
      </div>
    </div>

    <!-- Activity Panel -->
    <div id="activity-panel" style="display: none;">
      <div class="chat-panel-header">
        <h2>Activity</h2>
        <div class="header-actions">
          <button class="icon-btn" id="toggle-activity-panel-btn">◀</button>
        </div>
      </div>

      <div id="activity-list" style="overflow-y: auto; height: calc(100% - 60px);">
        <!-- Activity items will be listed here -->
      </div>
    </div>

    <!-- Calendar Panel -->
    <div id="calendar-panel" style="display: none;">
      <div class="chat-panel-header">
        <h2>Calendar</h2>
        <div class="header-actions">
          <button class="icon-btn" id="toggle-calendar-panel-btn">◀</button>
        </div>
      </div>

      <div id="calendar-list" style="overflow-y: auto; height: calc(100% - 60px);">
        <!-- Calendar items will be listed here -->
      </div>
    </div>

    <!-- Bookmark Panel -->
    <div id="bookmark-panel" style="display: none;">
      <div class="chat-panel-header">
        <h2>Bookmarks</h2>
        <div class="header-actions">
          <button class="icon-btn" id="refresh-bookmarks-btn" title="รีเฟรช">🔄</button>
          <button class="icon-btn" id="toggle-bookmark-panel-btn">◀</button>
        </div>
      </div>

      <div id="bookmark-list" style="overflow-y: auto; height: calc(100% - 60px); padding: 10px;">
        <!-- Bookmarks will be listed here -->
      </div>
    </div>

    <div id="game-container">
      <div id="game-header">
        <div id="room-info">
          <span id="current-room">Lobby</span>
          <span id="player-count">0 คน</span>
        </div>
        <div id="controls-info">
          <span>🎮 WASD/ลูกศร เพื่อเดิน | Space/Shift เพื่อกระโดด</span>
          <button id="room-list-btn">เปลี่ยนห้อง</button>
        </div>
      </div>

      <canvas id="game-canvas"></canvas>

      <!-- Chat Expand Toggle Button -->
      <button id="chat-expand-btn" title="ขยาย/ย่อ Chat">💬</button>

      <!-- Chat Messages Overlay (above chat-container) -->
      <div id="chat-messages-overlay"></div>

      <!-- Resize handle for chat overlay -->
      <div id="chat-resize-handle" title="ลากเพื่อปรับขนาด">
        <span class="resize-dots">⋮⋮⋮</span>
        <button id="chat-overlay-close-btn" title="ปิด Chat Overlay">✕</button>
      </div>

      <div id="chat-container">
        <!-- Settings Button (shows when collapsed) -->
        <button id="settings-toggle-btn" class="settings-toggle" title="เปิดเมนู">⚙️</button>

        <!-- Game Controller Style Buttons (shows when expanded) -->
        <div id="controller-btns" class="collapsed">
          <button id="screen-share-btn" class="controller-btn" title="แชร์หน้าจอ">🖥️</button>
          <div class="controller-middle">
            <button id="translator-btn" class="controller-btn" title="เปิด/ปิดโหมด Translator">🤖</button>
            <button id="mic-btn" class="controller-btn" title="คลิกเพื่อเปิด/ปิดไมค์">🎤</button>
          </div>
          <button id="voice-to-text-btn" class="controller-btn" title="พูดเพื่อพิมพ์">🎙️</button>
        </div>
        <div class="chat-input-container">
          <input
            type="text"
            id="chat-input"
            placeholder="💬 พิมพ์ข้อความหรือกดไมค์เพื่อพูด..."
            maxlength="200"
            autocomplete="off"
          />
        </div>
      </div>

      <div id="history-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>📜 ประวัติแชท</h2>
            <button id="close-history-btn" class="close-btn">✕</button>
          </div>
          <div id="history-list"></div>
        </div>
      </div>

      <div id="minigame-modal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 700px;">
          <div class="modal-header">
            <h2>🎮 Mini Game - Platform Adventure</h2>
            <button id="close-minigame-btn" class="close-btn">✕</button>
          </div>
          <div style="padding: 20px; text-align: center;">
            <div id="game-info" style="margin-bottom: 10px; font-size: 14px; color: #666;">
              <span>Score: <strong id="game-score">0</strong></span> |
              <span>Lives: <strong id="game-lives">3</strong></span> |
              <span>Level: <strong id="game-level">1</strong></span>
            </div>
            <canvas id="minigame-canvas" width="800" height="500" style="border: 2px solid #333; border-radius: 8px; background: #87CEEB;"></canvas>
            <div style="margin-top: 15px; font-size: 13px; color: #666;">
              <p>🎯 Controls: ← → Arrow keys to move, SPACE to jump</p>
              <p>🌟 Collect coins and avoid enemies!</p>
            </div>
          </div>
        </div>
      </div>

      <div id="settings-modal" class="modal">
        <div class="modal-content">
          <h2>⚙️ ตั้งค่า</h2>
          <div class="settings-group">
            <label>ขนาดตัวอักษร: <span id="font-size-value">18</span>px</label>
            <input type="range" id="font-size-slider" min="14" max="28" value="18" step="2">
          </div>
          <div class="settings-group">
            <label>การซูม: <span id="zoom-value">100</span>%</label>
            <input type="range" id="zoom-slider" min="70" max="400" value="100" step="10">
          </div>
          <div class="settings-group">
            <label>
              <input type="checkbox" id="show-chat-bubbles-checkbox" checked>
              แสดงข้อความเหนือหัวตัวละคร
            </label>
            <small style="color: #666; font-size: 12px; display: block; margin-left: 24px;">
              แสดงข้อความแชทลอยเหนือหัวตัวละครเมื่อพิมพ์
            </small>
          </div>
          <div class="settings-group">
            <label>เวลาแสดง: <span id="display-time-value">5</span> วินาที</label>
            <input type="range" id="display-time-slider" min="2" max="10" value="5" step="1">
          </div>
          <div class="settings-group">
            <label>🤖 AI API Key (สำหรับ Translator):</label>
            <input type="password" id="ai-api-key-input" placeholder="sk-..." style="width: 100%; padding: 8px; margin-top: 5px; border: 2px solid #ddd; border-radius: 4px;">
            <small style="color: #666; font-size: 12px;">แปลและแก้ไวยากรณ์เป็นภาษาอังกฤษอัตโนมัติก่อนส่งแชท</small>
          </div>
          <div class="settings-group">
            <label>💬 Status Message:</label>
            <input type="text" id="status-input" placeholder="e.g., In a meeting, Available..." maxlength="50" style="width: 100%; padding: 8px; margin-top: 5px; border: 2px solid #ddd; border-radius: 4px;">
            <small style="color: #666; font-size: 12px;">ข้อความสถานะที่จะแสดงให้ผู้อื่นเห็น</small>
          </div>
          <div class="settings-group">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="show-names-checkbox" style="width: 20px; height: 20px; cursor: pointer;">
              <span>แสดงชื่อผู้เล่นอื่น (ไม่แสดงชื่อตัวเอง)</span>
            </label>
          </div>
          <button id="close-settings-btn">ปิด</button>
        </div>
      </div>
    </div>
  </div>

  <div id="profile-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>👤 โปรไฟล์</h2>
        <button id="close-profile-btn" class="close-btn">✕</button>
      </div>

      <!-- User Info Section -->
      <div class="profile-section">
        <!-- 2 Column Layout -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">

          <!-- Left Column: User Info -->
          <div>
            <h3 style="margin-bottom: 15px; color: #667eea; font-size: 14px;">ข้อมูลผู้ใช้</h3>

            <!-- Username with color -->
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
              <div id="current-color-display" style="width: 40px; height: 40px; border-radius: 50%; border: 3px solid #ddd; cursor: pointer; transition: all 0.3s; flex-shrink: 0;"></div>
              <div style="flex: 1;">
                <div id="profile-username" style="font-weight: bold; color: #333; font-size: 16px; margin-bottom: 6px;"></div>
                <input type="text" id="profile-status-input" placeholder="ตั้งสถานะ..." maxlength="30" style="width: 200px; padding: 6px 10px; border: 1px solid #e0e0e0; border-radius: 6px; background: #f9f9f9; font-size: 12px; color: #666;">
              </div>
            </div>
          </div>

          <!-- Right Column: Character Preview -->
          <div>
            <h3 style="margin-bottom: 15px; color: #667eea; font-size: 14px; text-align: center;">ตัวอย่างตัวละคร</h3>
            <div id="character-preview-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
              <canvas id="preview-front" width="80" height="80" style="border: 2px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;"></canvas>
              <canvas id="preview-back" width="80" height="80" style="border: 2px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;"></canvas>
              <canvas id="preview-left" width="80" height="80" style="border: 2px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;"></canvas>
              <canvas id="preview-right" width="80" height="80" style="border: 2px solid #e0e0e0; border-radius: 8px; background: #f9f9f9;"></canvas>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 5px; text-align: center;">
              <small style="color: #999; font-size: 11px;">หน้า</small>
              <small style="color: #999; font-size: 11px;">หลัง</small>
              <small style="color: #999; font-size: 11px;">ซ้าย</small>
              <small style="color: #999; font-size: 11px;">ขวา</small>
            </div>
          </div>
        </div>

        <!-- Color Picker (Centered Below) -->
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; display: flex; flex-direction: column; align-items: center; gap: 12px;">
          <h4 style="margin: 0; color: #667eea; font-size: 14px;">เลือกสีตัวละคร</h4>
          <input type="color" id="color-picker" style="width: 80px; height: 80px; border: 3px solid #ddd; border-radius: 12px; cursor: pointer; padding: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <button id="confirm-color-btn" style="padding: 10px 24px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3); transition: all 0.2s;">✓ ยืนยันสี</button>
        </div>
      </div>

      <button id="save-profile-btn" style="width: 100%; margin-top: 20px; padding: 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">💾 บันทึก</button>
    </div>
  </div>

  <div id="room-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>🚪 เลือกห้อง</h2>
        <button id="close-modal-btn" class="close-btn">✕</button>
      </div>
      <div id="rooms-list"></div>
    </div>
  </div>

  <div id="object-sidebar" class="sidebar">
    <div class="sidebar-header">
      <h2>🛋️ เพิ่ม Object</h2>
      <button id="close-sidebar-btn" class="close-btn">✕</button>
    </div>
    <div id="object-categories"></div>
    <div id="object-items"></div>
    <div class="sidebar-footer">
      <button id="save-objects-btn" class="save-btn">💾 Save</button>
      <button id="cancel-objects-btn" class="cancel-btn">❌ Cancel</button>
    </div>
  </div>

  <!-- Screen Share Viewer Modal -->
  <div id="screen-share-modal" class="modal">
    <div class="screen-share-content">
      <div class="screen-share-header">
        <h2 id="screen-share-title">🖥️ <span id="screen-sharer-name">User</span> กำลังแชร์หน้าจอ</h2>
        <button id="close-screen-share-btn" class="close-btn">✕</button>
      </div>
      <div id="screen-share-container">
        <video id="screen-share-video" autoplay playsinline></video>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="game.js?v=20.3"></script>
</body>
</html>
