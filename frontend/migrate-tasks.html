<!DOCTYPE html>
<html>
<head>
    <title>Migrate Tasks - Add User Attribution</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-right: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        .success {
            background: #10b981;
            padding: 12px;
            border-radius: 8px;
            color: white;
            margin-top: 20px;
            display: none;
        }
        .info {
            background: #e0e7ff;
            padding: 12px;
            border-radius: 8px;
            color: #3730a3;
            margin-top: 20px;
        }
        pre {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Migrate Tasks - Add User Attribution</h1>

        <div class="info">
            <strong>This tool will:</strong>
            <ul>
                <li>Add <code>createdBy</code> and <code>createdAt</code> fields to all tasks that don't have them</li>
                <li>Add <code>updatedBy</code> and <code>updatedAt</code> fields to all tasks</li>
                <li>Set the default user to "John Doe" (you can change this)</li>
            </ul>
        </div>

        <div style="margin: 20px 0;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Current User Name:</label>
            <input type="text" id="userName" value="John Doe" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 10px;">

            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Current User Email:</label>
            <input type="email" id="userEmail" value="john@example.com" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
        </div>

        <button onclick="setCurrentUser()">1. Set Current User</button>
        <button onclick="migrateTasks()">2. Migrate All Tasks</button>
        <button onclick="showTasks()">3. View Tasks</button>

        <div id="success" class="success"></div>
        <div id="output" style="margin-top: 20px;"></div>
    </div>

    <script>
        function setCurrentUser() {
            const userName = document.getElementById('userName').value;
            const userEmail = document.getElementById('userEmail').value;

            const currentUser = { name: userName, email: userEmail };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            showSuccess(`Current user set to: ${userName} (${userEmail})`);
        }

        function migrateTasks() {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{"name": "John Doe", "email": "john@example.com"}');
            const now = new Date().toISOString();

            let migrated = 0;

            const updatedTasks = tasks.map(task => {
                const updated = { ...task };
                let changed = false;

                // Add createdAt and createdBy if missing
                if (!task.createdAt && !task.created_at) {
                    updated.createdAt = task.updatedAt || task.updated_at || now;
                    updated.created_at = updated.createdAt;
                    changed = true;
                }

                if (!task.createdBy && !task.created_by) {
                    updated.createdBy = currentUser.name;
                    updated.created_by = currentUser.name;
                    changed = true;
                }

                // Add updatedAt and updatedBy if missing
                if (!task.updatedAt && !task.updated_at) {
                    updated.updatedAt = now;
                    updated.updated_at = now;
                    changed = true;
                }

                if (!task.updatedBy && !task.updated_by) {
                    updated.updatedBy = currentUser.name;
                    updated.updated_by = currentUser.name;
                    changed = true;
                }

                if (changed) migrated++;

                return updated;
            });

            localStorage.setItem('tasks', JSON.stringify(updatedTasks));
            showSuccess(`‚úÖ Successfully migrated ${migrated} tasks! Refresh your app to see the changes.`);
        }

        function showTasks() {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            const output = document.getElementById('output');

            if (tasks.length === 0) {
                output.innerHTML = '<div class="info">No tasks found in localStorage</div>';
                return;
            }

            const taskSummary = tasks.map(task => ({
                id: task.id,
                title: task.title || task.text,
                createdBy: task.createdBy || task.created_by || '‚ùå Missing',
                createdAt: (task.createdAt || task.created_at || '').substring(0, 16).replace('T', ' ') || '‚ùå Missing',
                updatedBy: task.updatedBy || task.updated_by || '‚ùå Missing',
                updatedAt: (task.updatedAt || task.updated_at || '').substring(0, 16).replace('T', ' ') || '‚ùå Missing'
            }));

            output.innerHTML = `
                <h3>Tasks in localStorage (${tasks.length} total):</h3>
                <pre>${JSON.stringify(taskSummary, null, 2)}</pre>
            `;
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';

            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        // Show tasks on load
        window.addEventListener('load', () => {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                document.getElementById('userName').value = user.name;
                document.getElementById('userEmail').value = user.email;
            }
            showTasks();
        });
    </script>
</body>
</html>
